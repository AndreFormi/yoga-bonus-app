<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#F28402" />
  <link rel="manifest" href="/manifest.webmanifest">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;700;800;900&display=swap" rel="stylesheet">
  <title>Stuhl-Yoga Bonus</title>

  <style>
    :root{
      --bg:#F28402;
      --bg2:#D97002;
      --card:#F9F6F3;
      --text:#4B092D;
      --white:#F9F6F3;
      --accent:#03FBE6;
      --accent2:#4B092D;
      --muted: rgba(249,246,243,.85);
      --shadow: 0 10px 28px rgba(0,0,0,.18);
      --stroke: rgba(75,9,45,.18);
    }

    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      margin:0;
      padding:18px;
      background: linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      color: var(--white);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:6px;
    }

    h1{
      font-family: "Bebas Neue", Inter, sans-serif;
      letter-spacing: 1px;
      font-size: 46px;
      margin:0;
      line-height: .95;
    }

    .sub{
      color: var(--muted);
      font-size:14px;
      margin: 6px 0 10px;
      line-height:1.35;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .badgeRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin: 10px 0 12px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      letter-spacing:.2px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.25);
      user-select:none;
    }

    .badge.purple{ background: var(--accent2); color: var(--white); }
    .badge.cyan{ background: var(--accent); color: #0b0b0b; border: 1px solid rgba(0,0,0,.15); }

    .navbtn{
      background: transparent;
      color: var(--white);
      border: 1px solid rgba(249,246,243,.65);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight:900;
      cursor:pointer;
    }

    .card{
      background: var(--card);
      color: var(--text);
      border-radius: 18px;
      padding: 16px;
      margin: 12px 0;
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
    }

    .card h2{
      margin:0 0 10px;
      font-size:18px;
    }

    .mutedDark{
      opacity:.86;
      font-size:14px;
      line-height:1.35;
    }

    button{
      background: var(--accent);
      color: #0b0b0b;
      padding: 12px 14px;
      border: 0;
      border-radius: 14px;
      font-weight: 900;
      cursor:pointer;
    }

    button.secondary{
      background: transparent;
      color: var(--text);
      border: 1px solid rgba(75,9,45,.28);
    }

    input, select{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(75,9,45,.22);
      background: rgba(255,255,255,.78);
      color: var(--text);
      width: min(420px, 100%);
      outline: none;
      font-weight: 700;
    }

    .big{
      font-size: 52px;
      font-weight: 900;
      letter-spacing: 1px;
      margin-top: 2px;
    }

    .pill{
      display:inline-block;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75,9,45,.25);
      background: rgba(75,9,45,.08);
      font-size: 12px;
      font-weight: 900;
    }

    .list{ display:grid; gap:10px; }

    .item{
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(75,9,45,.18);
      background: rgba(255,255,255,.68);
      cursor:pointer;
      display:flex;
      gap:12px;
      align-items:flex-start;
    }

    .item:hover{ border-color: rgba(75,9,45,.35); }

    .thumb{
      width:78px;
      min-width:78px;
      height:78px;
      border-radius:14px;
      object-fit:cover;
      border: 1px solid rgba(75,9,45,.18);
      background: rgba(75,9,45,.06);
    }

    .itemTitle{ font-weight: 900; margin-bottom: 4px; }
    ul{ margin: 10px 0 0 18px; }
    .hide{ display:none; }

    .heroImg{
      width:100%;
      height:auto;
      border-radius: 16px;
      border: 1px solid rgba(75,9,45,.18);
      box-shadow: 0 10px 22px rgba(0,0,0,.12);
      margin: 10px 0 8px;
      background: rgba(75,9,45,.06);
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div>
      <h1>Stuhl-Yoga Bonus</h1>
      <div class="sub">Am Handy √∂ffnen und dann: Men√º/Teilen ‚Üí <b>Zum Home-Bildschirm hinzuf√ºgen</b>.</div>
    </div>

    <div class="row">
      <button id="viewTimer" class="navbtn">‚è± Routinen</button>
      <button id="viewPoses" class="navbtn">üßò √úbungen</button>
    </div>
  </div>

  <div class="badgeRow">
    <div class="badge purple">10 MINUTEN AM TAG</div>
    <div class="badge cyan">BONUS ‚Ä¢ Routinen + Timer</div>
  </div>

  <!-- ROUTINES VIEW -->
  <section id="timerView">
    <div class="card">
      <h2>Routine</h2>
      <img id="routineImg" class="heroImg" alt="Routine Bild" />

      <div class="row">
        <label class="mutedDark">
          Auswahl:
          <select id="routine"></select>
        </label>
        <button id="start">Start</button>
        <button id="pause" class="secondary">Pause</button>
        <button id="reset" class="secondary">Reset</button>
      </div>

      <div class="mutedDark" style="margin-top:10px">
        Demo: Routinen + √úbungen. Danach f√ºgen wir alle weiteren Positionen hinzu.
      </div>
    </div>

    <div class="card">
      <h2 id="poseName">Bereit</h2>
      <img id="poseImg" class="heroImg hide" alt="√úbungsbild" />

      <div class="big" id="timer">00:00</div>
      <div class="mutedDark" id="poseInfo">W√§hle eine Routine und dr√ºcke Start.</div>

      <div style="margin-top:12px" class="row">
        <span class="pill" id="stepPill">Schritt 0/0</span>
        <span class="pill" id="routinePill">‚Äî</span>
      </div>
    </div>
  </section>

  <!-- EXERCISES VIEW -->
  <section id="posesView" class="hide">
    <div class="card">
      <h2>√úbungen</h2>
      <div class="row">
        <input id="search" placeholder="Suche (z. B. R√ºcken, Atmung, Schultern)..." />
      </div>
      <div class="mutedDark" style="margin-top:10px">
        √ñffne eine √úbung und tippe auf <b>‚è± Timer starten</b>.
      </div>
    </div>

    <div class="list" id="poseList"></div>

    <div class="card hide" id="poseDetail">
      <div class="row" style="justify-content:space-between">
        <h2 id="dName">‚Äî</h2>
        <div class="row">
          <button id="startPoseTimer">‚è± Timer starten</button>
          <button id="back" class="secondary">‚Üê Zur√ºck</button>
        </div>
      </div>

      <img id="dImg" class="heroImg" alt="√úbungsbild" />

      <div class="row" style="margin: 8px 0 12px">
        <span class="pill" id="dTime">‚Äî</span>
        <span class="pill" id="dBenefits">‚Äî</span>
      </div>

      <h3 style="margin:0 0 8px">Anleitung</h3>
      <ul id="dSteps"></ul>

      <h3 style="margin:14px 0 8px">H√§ufige Fehler</h3>
      <ul id="dErrors"></ul>
    </div>
  </section>

  <script>
    // Helper: makes images work even if filename contains spaces
    function safeSrc(path){ return encodeURI(path); }

    // ====== √úBUNGEN (DE) ======
    const POSES = [
      // --- ATMUNG & ENTSPANNUNG ---
      {
        id: "respirazione-addominale",
        nome: "Bauchatmung (Zwerchfellatmung)",
        durataConsigliataSec: 60,
        benefici: "Beruhigt das Nervensystem, senkt Stress und hilft beim Runterkommen.",
        tags: ["atmung","entspannung","stress","sitzen"],
        immagine: "img/respirazione-addominale.png",
        istruzioni: [
          "Setz dich aufrecht hin, beide F√º√üe am Boden.",
          "Lege eine Hand auf den Bauch, die andere auf die Brust.",
          "Atme durch die Nase ein: Der Bauch hebt sich.",
          "Atme langsam aus: Der Bauch senkt sich. Wiederhole ruhig."
        ],
        erroriComuni: [
          "Nur in die Brust atmen (Bauch bleibt still).",
          "Schultern hochziehen oder verkrampfen.",
          "Zu schnell atmen."
        ]
      },
      {
        id: "respirazione-4-6",
        nome: "Atmung 4‚Äì6 (ein 4 / aus 6)",
        durataConsigliataSec: 60,
        benefici: "Aktiviert Entspannung: l√§ngeres Ausatmen beruhigt Herz und Geist.",
        tags: ["atmung","entspannung","stress","sitzen"],
        immagine: "img/respirazione-4-6.png",
        istruzioni: [
          "Setz dich bequem hin, Schultern locker.",
          "Atme 4 Sekunden durch die Nase ein.",
          "Atme 6 Sekunden langsam durch den Mund aus.",
          "Wiederhole 6‚Äì10 Atemz√ºge in ruhigem Tempo."
        ],
        erroriComuni: [
          "Die Luft anhalten (unabsichtlich).",
          "Zu stark pressen beim Ausatmen.",
          "Unruhige Schultern/Brustkorb."
        ]
      },
      {
        id: "respirazione-5-5",
        nome: "Atmung 5‚Äì5 (Resonanzatmung)",
        durataConsigliataSec: 60,
        benefici: "Gleichm√§√üiger Rhythmus ‚Äì unterst√ºtzt innere Ruhe und Balance.",
        tags: ["atmung","entspannung","balance","sitzen"],
        immagine: "img/respirazione-5-5.png",
        istruzioni: [
          "Setz dich aufrecht hin, Kiefer locker.",
          "Atme 5 Sekunden ein (Nase).",
          "Atme 5 Sekunden aus (Mund oder Nase).",
          "Bleib weich im Gesicht und in den Schultern."
        ],
        erroriComuni: [
          "Zu tief/zu stark atmen ‚Üí Schwindel.",
          "Den Rhythmus hektisch beschleunigen.",
          "Spannung im Nacken."
        ]
      },
      {
        id: "rilassamento-seduto",
        nome: "Entspannendes Sitzen (Abschluss)",
        durataConsigliataSec: 120,
        benefici: "L√∂st Restspannung, bringt K√∂rper und Atem zur Ruhe.",
        tags: ["entspannung","abschluss","stress","sitzen"],
        immagine: "img/entspannendes-sitzen.png",
        istruzioni: [
          "Lehn dich bequem an oder sitz aufrecht ‚Äì wie es gut tut.",
          "Lass Schultern, Kiefer und H√§nde weich werden.",
          "Atme nat√ºrlich und bleib 1‚Äì2 Minuten still.",
          "Wenn Gedanken kommen: freundlich zum Atem zur√ºck."
        ],
        erroriComuni: [
          "Unbequeme Haltung w√§hlen (lieber Kissen nutzen).",
          "Zu fr√ºh wieder aufspringen ‚Äì bleib noch ein paar Atemz√ºge."
        ]
      },

      // --- R√úCKEN & WIRBELS√ÑULE ---
      {
        id: "gatto-mucca-da-seduti",
        nome: "Katze‚ÄìKuh im Sitzen",
        durataConsigliataSec: 60,
        benefici: "Sanfte Mobilisation der Wirbels√§ule, ideal zum Aufw√§rmen.",
        tags: ["r√ºcken","wirbels√§ule","mobilit√§t","sitzen"],
        immagine: "img/gatto-mucca-da-seduti.png",
        istruzioni: [
          "Setz dich aufrecht hin, H√§nde auf die Oberschenkel.",
          "Einatmen: Brust √∂ffnen, R√ºcken sanft in die L√§nge (Kuh).",
          "Ausatmen: R√ºcken rund machen, Kinn leicht zur Brust (Katze).",
          "Langsam 6‚Äì10 Wiederholungen im Atemrhythmus."
        ],
        erroriComuni: [
          "Nur den Hals bewegen statt die ganze Wirbels√§ule.",
          "Ins Hohlkreuz dr√ºcken.",
          "Atem anhalten."
        ]
      },
      {
        id: "torsione-seduta-destra-sinistra",
        nome: "Sitzende Drehung (rechts/links)",
        durataConsigliataSec: 60,
        benefici: "Mehr Beweglichkeit im R√ºcken, l√∂st Spannung im Oberk√∂rper.",
        tags: ["r√ºcken","drehung","mobilit√§t","sitzen"],
        immagine: "img/torsione-seduta-destra-sinistra.png",
        istruzioni: [
          "Setz dich hoch hin, Schultern weich, F√º√üe am Boden.",
          "Dreh den Oberk√∂rper langsam nach rechts ‚Äì ohne zu ziehen.",
          "Bleib 3‚Äì4 Atemz√ºge, dann zur√ºck zur Mitte.",
          "Wiederhole nach links."
        ],
        erroriComuni: [
          "Mit den Armen zerren oder ruckartig drehen.",
          "Brustkorb einsinken lassen.",
          "Schultern hochziehen."
        ]
      },
      {
        id: "piegamento-in-avanti-seduti-schiena-lunga",
        nome: "Vorbeuge im Sitzen (langer R√ºcken)",
        durataConsigliataSec: 60,
        benefici: "Entlastet den R√ºcken, dehnt sanft die hintere Kette.",
        tags: ["r√ºcken","dehnung","sitzen"],
        immagine: "img/piegamento-in-avanti-seduti-schiena-lunga.png",
        istruzioni: [
          "Setz dich an die Stuhlkante, R√ºcken lang.",
          "Beuge dich aus der H√ºfte nach vorn (nicht rund zusammenfallen).",
          "H√§nde auf Schienbein oder Oberschenkel ablegen.",
          "2‚Äì4 Atemz√ºge halten, dann langsam aufrichten."
        ],
        erroriComuni: [
          "R√ºcken stark rund machen und h√§ngen lassen.",
          "Zu tief gehen und pressen.",
          "Nacken verspannen."
        ]
      },
      {
        id: "allungamento-laterale-busto-seduti",
        nome: "Seitliche Rumpfdehnung im Sitzen",
        durataConsigliataSec: 60,
        benefici: "√ñffnet die Flanken und verbessert die Beweglichkeit der Wirbels√§ule.",
        tags: ["r√ºcken","seitdehnung","mobilit√§t","sitzen"],
        immagine: "img/allungamento-laterale-busto-seduti.png",
        istruzioni: [
          "Setz dich aufrecht hin, F√º√üe am Boden.",
          "Hebe einen Arm und neige dich sanft zur Seite.",
          "Atme ruhig 3‚Äì4 Atemz√ºge.",
          "Wechsle die Seite."
        ],
        erroriComuni: [
          "Schulter zum Ohr ziehen.",
          "Nach vorn kippen statt zur Seite.",
          "Atem flach werden lassen."
        ]
      },
      {
        id: "apertura-petto-braccia-indietro",
        nome: "Brust√∂ffnung im Sitzen (Arme nach hinten)",
        durataConsigliataSec: 60,
        benefici: "√ñffnet den Brustkorb, verbessert die Haltung und Atmung.",
        tags: ["haltung","brust","schultern","sitzen"],
        immagine: "img/apertura-petto-braccia-indietro.png",
        istruzioni: [
          "Setz dich hoch hin, Kinn parallel zum Boden.",
          "Ziehe die Arme leicht nach hinten, Schulterbl√§tter sanft zusammen.",
          "Brustbein hebt sich ‚Äì ohne ins Hohlkreuz zu fallen.",
          "Halte 3‚Äì5 Atemz√ºge, dann l√∂sen."
        ],
        erroriComuni: [
          "Hohlkreuz machen statt Brust √∂ffnen.",
          "Schultern hochziehen.",
          "Nacken nach hinten dr√ºcken."
        ]
      },

      // --- NACKEN & SCHULTERN ---
      {
        id: "inclinazione-laterale-collo",
        nome: "Nacken seitlich dehnen",
        durataConsigliataSec: 45,
        benefici: "L√∂st Spannung im Nacken und macht den Hals beweglicher.",
        tags: ["nacken","schultern","entspannung","sitzen"],
        immagine: "img/inclinazione-laterale-collo.png",
        istruzioni: [
          "Setz dich aufrecht hin, Schultern locker.",
          "Neige den Kopf langsam zur rechten Seite (Ohr Richtung Schulter).",
          "2‚Äì3 Atemz√ºge halten, dann zur Mitte zur√ºck.",
          "Wechsle nach links."
        ],
        erroriComuni: [
          "Schulter hochziehen.",
          "Am Kopf ziehen oder dr√ºcken.",
          "Zu schnell wechseln."
        ]
      },
      {
        id: "rotazioni-lente-del-collo",
        nome: "Langsame Nackenrotation",
        durataConsigliataSec: 45,
        benefici: "Sanfte Mobilisation f√ºr Nacken und oberen R√ºcken.",
        tags: ["nacken","mobilit√§t","sitzen"],
        immagine: "img/rotazioni-lente-del-collo.png",
        istruzioni: [
          "Kinn leicht zur Brust, Nacken weich.",
          "Dreh den Kopf langsam nach rechts (ohne zu kreisen).",
          "Zur Mitte zur√ºck und dann nach links.",
          "Bewege dich ruhig, ohne Schmerz."
        ],
        erroriComuni: [
          "Gro√üe Kopfkreise machen (zu viel Druck).",
          "In den Schmerz drehen.",
          "Schultern anspannen."
        ]
      },
      {
        id: "circonduzioni-spalle",
        nome: "Schulterkreisen",
        durataConsigliataSec: 45,
        benefici: "Lockert Schultern und verbessert die Durchblutung im Oberk√∂rper.",
        tags: ["schultern","mobilit√§t","entspannung","sitzen"],
        immagine: "img/circonduzioni-spalle.png",
        istruzioni: [
          "Sitz aufrecht, Arme locker.",
          "Kreise beide Schultern langsam nach hinten (8‚Äì10√ó).",
          "Dann nach vorn (8‚Äì10√ó).",
          "Atme gleichm√§√üig weiter."
        ],
        erroriComuni: [
          "Zu schnell und ruckartig kreisen.",
          "Kopf/Schultern verspannen.",
          "Atmen vergessen."
        ]
      },
      {
        id: "spremi-scapole",
        nome: "Schulterbl√§tter zusammenziehen",
        durataConsigliataSec: 45,
        benefici: "St√§rkt die Haltungsmuskulatur und entlastet Nacken/Schultern.",
        tags: ["haltung","schultern","r√ºcken","sitzen"],
        immagine: "img/spremi-scapole.png",
        istruzioni: [
          "Setz dich aufrecht hin, Arme seitlich locker.",
          "Zieh die Schulterbl√§tter sanft zueinander (als w√ºrdest du einen Stift halten).",
          "2 Sekunden halten, dann l√∂sen.",
          "8‚Äì12 Wiederholungen."
        ],
        erroriComuni: [
          "Schultern hochziehen statt nach hinten/unten.",
          "Zu stark pressen.",
          "R√ºcken ins Hohlkreuz dr√ºcken."
        ]
      },

      // --- H√úFTE & BEINE ---
      {
        id: "estensione-gamba-seduto",
        nome: "Beinstrecken im Sitzen",
        durataConsigliataSec: 60,
        benefici: "Kr√§ftigt Oberschenkel und unterst√ºtzt stabile Knie.",
        tags: ["beine","kr√§ftigung","sitzen"],
        immagine: "img/estensione-gamba-seduto.png",
        istruzioni: [
          "Setz dich aufrecht hin, F√º√üe am Boden.",
          "Strecke ein Bein nach vorn, Fu√ü flex (Zehen Richtung Nase).",
          "1‚Äì2 Sekunden halten, dann langsam absetzen.",
          "Wechsle das Bein, 8‚Äì10√ó pro Seite."
        ],
        erroriComuni: [
          "Ruckartig strecken.",
          "Oberk√∂rper nach hinten kippen.",
          "Atem anhalten."
        ]
      },
      {
        id: "sollevamento-ginocchio-seduto",
        nome: "Knieheben im Sitzen (langsames Marschieren)",
        durataConsigliataSec: 60,
        benefici: "F√∂rdert Durchblutung, aktiviert Bauch und H√ºftbeuger.",
        tags: ["beine","kreislauf","koordination","sitzen"],
        immagine: "img/sollevamento-ginocchio-seduto.png",
        istruzioni: [
          "Setz dich aufrecht hin, H√§nde ggf. am Stuhl.",
          "Hebe abwechselnd ein Knie so hoch wie angenehm.",
          "Bewege dich langsam und kontrolliert.",
          "30‚Äì60 Sekunden im ruhigen Tempo."
        ],
        erroriComuni: [
          "Zu schnell ‚Äì ohne Kontrolle.",
          "Rundr√ºcken.",
          "Schultern hochziehen."
        ]
      },
      {
        id: "figura-4-apertura-anca",
        nome: "H√ºft√∂ffnung im Sitzen",
        durataConsigliataSec: 60,
        benefici: "√ñffnet die H√ºfte und kann Spannung im unteren R√ºcken lindern.",
        tags: ["h√ºfte","dehnung","sitzen"],
        immagine: "img/figura-4-apertura-anca.png",
        istruzioni: [
          "Setz dich aufrecht hin.",
          "Lege den rechten Kn√∂chel auf das linke Knie (wie eine ‚Äû4‚Äú).",
          "Halte den R√ºcken lang und beuge dich sanft nach vorn (nur wenn es gut tut).",
          "Wechsle die Seite."
        ],
        erroriComuni: [
          "Knie nach unten dr√ºcken.",
          "R√ºcken rund machen.",
          "Schmerzen ignorieren."
        ]
      },
      {
        id: "rotazioni-caviglie",
        nome: "Fu√ügelenke kreisen",
        durataConsigliataSec: 45,
        benefici: "Mobilisiert die Sprunggelenke und unterst√ºtzt die Durchblutung.",
        tags: ["f√º√üe","sprunggelenk","mobilit√§t","sitzen"],
        // tuo file ha spazi: "rotazioni- delle- caviglie.png"
        // safeSrc() lo gestisce
        immagine: "img/rotazioni- delle- caviglie.png",
        istruzioni: [
          "Setz dich aufrecht hin, ein Fu√ü leicht angehoben.",
          "Kreise das Fu√ügelenk langsam 8‚Äì10√ó in eine Richtung.",
          "Dann 8‚Äì10√ó in die andere Richtung.",
          "Wechsle den Fu√ü."
        ],
        erroriComuni: [
          "Zu schnell kreisen.",
          "Bein verkrampfen.",
          "Nur kleine, hektische Bewegungen."
        ]
      }
    ];

    // ====== ROUTINEN (DE) ======
    const routines = [
      {
        name: "Routine: Atmung & Entspannung (10 Min)",
        image: "img/atmung-entspannung-10-minuten.png",
        steps: [
          { poseId:"respirazione-addominale", sec:150 },
          { poseId:"respirazione-4-6", sec:150 },
          { poseId:"respirazione-5-5", sec:150 },
          { poseId:"rilassamento-seduto", sec:150 }
        ]
      },
      {
        name: "Routine: R√ºcken & Wirbels√§ule (10 Min)",
        image: "img/routine-schiena-colonna.png",
        steps: [
          { poseId:"gatto-mucca-da-seduti", sec:120 },
          { poseId:"torsione-seduta-destra-sinistra", sec:120 },
          { poseId:"piegamento-in-avanti-seduti-schiena-lunga", sec:120 },
          { poseId:"allungamento-laterale-busto-seduti", sec:120 },
          { poseId:"apertura-petto-braccia-indietro", sec:120 }
        ]
      },
      {
        name: "Routine: Nacken & Schultern (10 Min)",
        image: "img/routine-collo-spalle.png",
        steps: [
          { poseId:"inclinazione-laterale-collo", sec:120 },
          { poseId:"rotazioni-lente-del-collo", sec:120 },
          { poseId:"circonduzioni-spalle", sec:120 },
          { poseId:"spremi-scapole", sec:240 }
        ]
      },
      {
        name: "Routine: H√ºfte & Beine (10 Min)",
        image: "img/routine-huefte-beine.png",
        steps: [
          { poseId:"estensione-gamba-seduto", sec:150 },
          { poseId:"sollevamento-ginocchio-seduto", sec:150 },
          { poseId:"figura-4-apertura-anca", sec:180 },
          { poseId:"rotazioni-caviglie", sec:120 }
        ]
      }
    ];

    // ====== NAV ======
    const timerView = document.getElementById("timerView");
    const posesView = document.getElementById("posesView");
    document.getElementById("viewTimer").onclick = () => {
      timerView.classList.remove("hide");
      posesView.classList.add("hide");
    };
    document.getElementById("viewPoses").onclick = () => {
      posesView.classList.remove("hide");
      timerView.classList.add("hide");
      renderList();
    };

    // ====== ROUTINE SELECT ======
    const sel = document.getElementById("routine");
    routines.forEach((r,i)=> {
      const o=document.createElement("option");
      o.value=i;
      o.textContent=r.name;
      sel.appendChild(o);
    });

    const $routineImg = document.getElementById("routineImg");
    function updateRoutineImage(){
      const r = routines[+sel.value];
      $routineImg.src = safeSrc(r.image);
      $routineImg.alt = `Bild: ${r.name}`;
    }
    updateRoutineImage();

    // ====== TIMER ======
    let interval=null, stepIdx=0, remaining=0, paused=true, current=null;

    const $timer=document.getElementById("timer");
    const $pose=document.getElementById("poseName");
    const $info=document.getElementById("poseInfo");
    const $stepPill=document.getElementById("stepPill");
    const $routinePill=document.getElementById("routinePill");
    const $poseImg=document.getElementById("poseImg");

    function fmt(s){
      const m = Math.floor(s/60).toString().padStart(2,'0');
      const sec = (s%60).toString().padStart(2,'0');
      return `${m}:${sec}`;
    }
    function getPoseById(id){ return POSES.find(p=>p.id===id); }

    function setPoseImage(pose){
      if(!pose || !pose.immagine){
        $poseImg.classList.add("hide");
        $poseImg.removeAttribute("src");
        return;
      }
      $poseImg.src = safeSrc(pose.immagine);
      $poseImg.alt = `Bild: ${pose.nome}`;
      $poseImg.classList.remove("hide");
    }

    function loadStep(){
      const step = current.steps[stepIdx];
      const pose = getPoseById(step.poseId) || {nome:"√úbung", benefici:"", immagine:""};
      remaining = step.sec;
      $pose.textContent = pose.nome;
      $info.textContent = pose.benefici || "‚Äî";
      $timer.textContent = fmt(remaining);
      $stepPill.textContent = `Schritt ${stepIdx+1}/${current.steps.length}`;
      $routinePill.textContent = current.name || "‚Äî";
      setPoseImage(pose);
    }

    function tick(){
      if(paused) return;
      remaining--;
      $timer.textContent = fmt(Math.max(0,remaining));
      if(remaining <= 0){
        stepIdx++;
        if(stepIdx >= current.steps.length){
          paused=true;
          clearInterval(interval);
          interval=null;
          $pose.textContent="Routine fertig ‚úÖ";
          $info.textContent="Super! M√∂chtest du noch eine Routine machen?";
          $timer.textContent="00:00";
          $stepPill.textContent = `Schritt ${current.steps.length}/${current.steps.length}`;
          setPoseImage(null);

          const done = JSON.parse(localStorage.getItem("yoga_done")||"[]");
          done.push({ts:Date.now(), routine:current.name});
          localStorage.setItem("yoga_done", JSON.stringify(done));
          return;
        }
        loadStep();
      }
    }

    document.getElementById("start").onclick = () => {
      if(!current){
        current = routines[+sel.value];
        stepIdx=0;
        loadStep();
      }
      paused=false;
      if(!interval) interval=setInterval(tick,1000);
    };

    document.getElementById("pause").onclick = () => paused=true;

    document.getElementById("reset").onclick = () => {
      paused=true; stepIdx=0; current=null;
      if(interval){ clearInterval(interval); interval=null; }
      $pose.textContent="Bereit";
      $info.textContent="W√§hle eine Routine und dr√ºcke Start.";
      $timer.textContent="00:00";
      $stepPill.textContent="Schritt 0/0";
      $routinePill.textContent="‚Äî";
      setPoseImage(null);
    };

    sel.onchange = () => {
      stepIdx=0;
      current=null;
      paused=true;
      if(interval){ clearInterval(interval); interval=null; }
      $pose.textContent="Bereit";
      $info.textContent="Dr√ºcke Start.";
      $timer.textContent="00:00";
      $stepPill.textContent="Schritt 0/0";
      $routinePill.textContent="‚Äî";
      setPoseImage(null);
      updateRoutineImage();
    };

    // ====== √úBUNGEN: LISTE + DETAIL + TIMER ======
    const $list = document.getElementById("poseList");
    const $search = document.getElementById("search");
    const $detail = document.getElementById("poseDetail");
    const $dImg = document.getElementById("dImg");
    let selectedPoseId = null;

    function renderList(){
      $detail.classList.add("hide");
      $list.classList.remove("hide");

      const q = ($search.value||"").trim().toLowerCase();

      const filtered = POSES.filter(p => {
        const text = (p.nome+" "+p.benefici+" "+(p.tags||[]).join(" ")).toLowerCase();
        return !q || text.includes(q);
      });

      $list.innerHTML = "";
      filtered.forEach(p => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <img class="thumb" src="${safeSrc(p.immagine)}" alt="thumb ${p.nome}">
          <div>
            <div class="itemTitle">${p.nome}</div>
            <div class="mutedDark">${p.benefici}</div>
            <div style="margin-top:10px" class="row">
              <span class="pill">~ ${Math.max(1, Math.round((p.durataConsigliataSec||60)/60))} min</span>
            </div>
          </div>
        `;
        div.onclick = () => showDetail(p.id);
        $list.appendChild(div);
      });

      if(filtered.length === 0){
        const empty = document.createElement("div");
        empty.className="card";
        empty.innerHTML = `<div class="mutedDark">Keine Treffer. Versuche ein anderes Wort.</div>`;
        $list.appendChild(empty);
      }
    }

    function showDetail(id){
      selectedPoseId = id;
      const p = getPoseById(id);
      if(!p) return;

      document.getElementById("dName").textContent = p.nome;
      document.getElementById("dTime").textContent = `Empfohlene Dauer: ${fmt(p.durataConsigliataSec||60)}`;
      document.getElementById("dBenefits").textContent = p.benefici;

      $dImg.src = safeSrc(p.immagine);
      $dImg.alt = `Bild: ${p.nome}`;

      const steps = document.getElementById("dSteps");
      const errs = document.getElementById("dErrors");
      steps.innerHTML = ""; errs.innerHTML = "";

      (p.istruzioni||[]).forEach(s => {
        const li=document.createElement("li");
        li.textContent=s;
        steps.appendChild(li);
      });

      (p.erroriComuni||[]).forEach(s => {
        const li=document.createElement("li");
        li.textContent=s;
        errs.appendChild(li);
      });

      $list.classList.add("hide");
      $detail.classList.remove("hide");
      window.scrollTo({top:0, behavior:"smooth"});
    }

    document.getElementById("back").onclick = () => {
      $detail.classList.add("hide");
      $list.classList.remove("hide");
    };

    document.getElementById("startPoseTimer").onclick = () => {
      if(!selectedPoseId) return;
      const p = getPoseById(selectedPoseId);
      if(!p) return;

      const secs = p.durataConsigliataSec ? p.durataConsigliataSec : 60;

      current = { name: p.nome, steps: [{ poseId: p.id, sec: secs }] };
      stepIdx = 0;
      paused = false;

      loadStep();

      timerView.classList.remove("hide");
      posesView.classList.add("hide");

      if(!interval) interval = setInterval(tick, 1000);
    };

    $search.oninput = renderList;

    // ====== PWA ======
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("/sw.js").catch(()=>{});
    }
  </script>
</body>
</html>
