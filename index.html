<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#F28402" />
  <link rel="manifest" href="/manifest.webmanifest">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;700;800;900&display=swap" rel="stylesheet">
  <title>Stuhl Yoga Bonus</title>

  <style>
    :root{
      --bg:#F28402;        /* arancione cover */
      --bg2:#D97002;       /* arancione scuro */
      --card:#F9F6F3;      /* bianco caldo */
      --text:#4B092D;      /* viola scuro */
      --white:#F9F6F3;
      --accent:#03FBE6;    /* turchese banner */
      --accent2:#4B092D;
      --muted: rgba(249,246,243,.85);
      --shadow: 0 10px 28px rgba(0,0,0,.18);
      --stroke: rgba(75,9,45,.18);
    }

    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      margin:0;
      padding:18px;
      background: linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      color: var(--white);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:6px;
    }

    h1{
      font-family: "Bebas Neue", Inter, sans-serif;
      letter-spacing: 1px;
      font-size: 46px;
      margin:0;
      line-height: .95;
    }

    .sub{
      color: var(--muted);
      font-size:14px;
      margin: 6px 0 10px;
      line-height:1.35;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .badgeRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin: 10px 0 12px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      letter-spacing:.2px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.25);
      user-select:none;
    }

    .badge.purple{
      background: var(--accent2);
      color: var(--white);
    }

    .badge.cyan{
      background: var(--accent);
      color: #0b0b0b;
      border: 1px solid rgba(0,0,0,.15);
    }

    .navbtn{
      background: transparent;
      color: var(--white);
      border: 1px solid rgba(249,246,243,.65);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight:900;
      cursor:pointer;
    }

    .card{
      background: var(--card);
      color: var(--text);
      border-radius: 18px;
      padding: 16px;
      margin: 12px 0;
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
    }

    .card h2{
      margin:0 0 10px;
      font-size:18px;
    }

    .mutedDark{
      opacity:.86;
      font-size:14px;
      line-height:1.35;
    }

    button{
      background: var(--accent);
      color: #0b0b0b;
      padding: 12px 14px;
      border: 0;
      border-radius: 14px;
      font-weight: 900;
      cursor:pointer;
    }

    button.secondary{
      background: transparent;
      color: var(--text);
      border: 1px solid rgba(75,9,45,.28);
    }

    input, select{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(75,9,45,.22);
      background: rgba(255,255,255,.78);
      color: var(--text);
      width: min(420px, 100%);
      outline: none;
      font-weight: 700;
    }

    .big{
      font-size: 52px;
      font-weight: 900;
      letter-spacing: 1px;
      margin-top: 2px;
    }

    .pill{
      display:inline-block;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75,9,45,.25);
      background: rgba(75,9,45,.08);
      font-size: 12px;
      font-weight: 900;
    }

    .list{
      display:grid;
      gap:10px;
    }

    .item{
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(75,9,45,.18);
      background: rgba(255,255,255,.68);
      cursor:pointer;
    }

    .item:hover{
      border-color: rgba(75,9,45,.35);
    }

    .itemTitle{
      font-weight: 900;
      margin-bottom: 4px;
    }

    ul{
      margin: 10px 0 0 18px;
    }

    .hide{ display:none; }
  </style>
</head>

<body>
  <div class="topbar">
    <div>
      <h1>Stuhl-Yoga Bonus</h1>
      <div class="sub">Apri dal telefono e poi: Menu/Condividi ‚Üí <b>Aggiungi a schermata Home</b>.</div>
    </div>

    <div class="row">
      <button id="viewTimer" class="navbtn">‚è± Timer</button>
      <button id="viewPoses" class="navbtn">üßò Posizioni</button>
    </div>
  </div>

  <div class="badgeRow">
    <div class="badge purple">10 MINUTI AL GIORNO</div>
    <div class="badge cyan">INKL. BONUS ‚Ä¢ Routine + Timer</div>
  </div>

  <!-- TIMER VIEW -->
  <section id="timerView">
    <div class="card">
      <h2>Routine (demo)</h2>
      <div class="row">
        <label class="mutedDark">
          Seleziona:
          <select id="routine"></select>
        </label>
        <button id="start">Start</button>
        <button id="pause" class="secondary">Pausa</button>
        <button id="reset" class="secondary">Reset</button>
      </div>
      <div class="mutedDark" style="margin-top:10px">
        Questa √® una demo. Quando vuoi, inseriamo le 100 posizioni del libro e creiamo routine complete.
      </div>
    </div>

    <div class="card">
      <h2 id="poseName">Pronto</h2>
      <div class="big" id="timer">00:00</div>
      <div class="mutedDark" id="poseInfo">Scegli una routine e premi Start.</div>

      <div style="margin-top:12px" class="row">
        <span class="pill" id="stepPill">Step 0/0</span>
        <span class="pill" id="routinePill">‚Äî</span>
      </div>
    </div>
  </section>

  <!-- POSES VIEW -->
  <section id="posesView" class="hide">
    <div class="card">
      <h2>Posizioni</h2>
      <div class="row">
        <input id="search" placeholder="Cerca (es. schiena, spalle, relax)..." />
        <select id="filterLevel">
          <option value="">Tutti i livelli</option>
          <option>Base</option>
          <option>Intermedio</option>
          <option>Avanzato</option>
        </select>
      </div>
      <div class="mutedDark" style="margin-top:10px">
        Apri una posizione e premi <b>‚è± Avvia timer</b> per partire con la durata consigliata.
      </div>
    </div>

    <div class="list" id="poseList"></div>

    <div class="card hide" id="poseDetail">
      <div class="row" style="justify-content:space-between">
        <h2 id="dName">‚Äî</h2>
        <div class="row">
          <button id="startPoseTimer">‚è± Avvia timer</button>
          <button id="back" class="secondary">‚Üê Indietro</button>
        </div>
      </div>

      <div class="row" style="margin: 8px 0 12px">
        <span class="pill" id="dLevel">‚Äî</span>
        <span class="pill" id="dTime">‚Äî</span>
        <span class="pill" id="dBenefits">‚Äî</span>
      </div>

      <h3 style="margin:0 0 8px">Istruzioni</h3>
      <ul id="dSteps"></ul>

      <h3 style="margin:14px 0 8px">Errori comuni</h3>
      <ul id="dErrors"></ul>

      <div class="mutedDark" style="margin-top:12px">
        (Opzionale) Qui possiamo aggiungere immagini o video per ogni posizione.
      </div>
    </div>
  </section>

  <script>
    // ====== DATI DEMO (poi li sostituiamo con le 100 posizioni) ======
    const POSES = [
      {
        id: "respiro",
        nome: "Respirazione consapevole",
        livello: "Base",
        durataConsigliataSec: 60,
        benefici: "Calma mentale, focus, preparazione",
        tags: ["relax","respiro","mindfulness"],
        istruzioni: [
          "Siediti comodo (anche su sedia), schiena lunga.",
          "Inspira dal naso per 4 secondi.",
          "Espira lentamente per 6 secondi, spalle morbide."
        ],
        erroriComuni: [
          "Spalle tese e respiro alto nel petto.",
          "Trattenere il fiato senza volerlo."
        ]
      },
      {
        id: "gatto-mucca",
        nome: "Gatto‚ÄìMucca (mobilit√† della colonna)",
        livello: "Base",
        durataConsigliataSec: 60,
        benefici: "Riscaldamento dolce, mobilit√† della schiena",
        tags: ["schiena","mobilit√†","warmup"],
        istruzioni: [
          "Seduto o in quadrupedia: allunga la colonna.",
          "Inspira: apri il petto (Mucca).",
          "Espira: arrotonda la schiena (Gatto)."
        ],
        erroriComuni: [
          "Muovere solo il collo.",
          "Inarcare troppo la zona lombare."
        ]
      },
      {
        id: "allungamento-spalle",
        nome: "Allungamento spalle da seduti",
        livello: "Base",
        durataConsigliataSec: 60,
        benefici: "Rilassa spalle e collo",
        tags: ["spalle","collo","relax"],
        istruzioni: [
          "Siediti dritto, piedi a terra.",
          "Porta una mano al gomito opposto e avvicina delicatamente al petto.",
          "Respira e cambia lato."
        ],
        erroriComuni: [
          "Tirare troppo forte.",
          "Spalle sollevate verso le orecchie."
        ]
      },
      {
        id: "torsione",
        nome: "Torsione dolce da seduti",
        livello: "Base",
        durataConsigliataSec: 60,
        benefici: "Mobilit√† della colonna, respiro pi√π ampio",
        tags: ["schiena","mobilit√†"],
        istruzioni: [
          "Siediti alto, mani sulle cosce.",
          "Ruota il busto lentamente verso destra, senza forzare.",
          "Mantieni 3‚Äì4 respiri e cambia lato."
        ],
        erroriComuni: [
          "Forzare la rotazione.",
          "Chiudere il petto e collassare in avanti."
        ]
      },
      {
        id: "rilassamento",
        nome: "Rilassamento finale (Savasana da seduti)",
        livello: "Base",
        durataConsigliataSec: 120,
        benefici: "Recupero, rilascio tensioni",
        tags: ["relax","finale","recupero"],
        istruzioni: [
          "Siediti comodo, appoggia la schiena.",
          "Rilassa mandibola e spalle.",
          "Respira naturale e resta fermo."
        ],
        erroriComuni: [
          "Muoversi continuamente.",
          "Postura scomoda (aggiungi un cuscino se serve)."
        ]
      }
    ];

    const routines = [
      { name: "10 min Mattina (Demo)", steps: [
        { poseId:"respiro", sec:60 },
        { poseId:"gatto-mucca", sec:60 },
        { poseId:"allungamento-spalle", sec:60 },
        { poseId:"torsione", sec:60 },
        { poseId:"rilassamento", sec:360 }
      ]},
      { name: "8 min Schiena (Demo)", steps: [
        { poseId:"gatto-mucca", sec:90 },
        { poseId:"torsione", sec:90 },
        { poseId:"rilassamento", sec:300 }
      ]}
    ];

    // ====== NAV ======
    const timerView = document.getElementById("timerView");
    const posesView = document.getElementById("posesView");
    document.getElementById("viewTimer").onclick = () => {
      timerView.classList.remove("hide");
      posesView.classList.add("hide");
    };
    document.getElementById("viewPoses").onclick = () => {
      posesView.classList.remove("hide");
      timerView.classList.add("hide");
      renderList();
    };

    // ====== TIMER ======
    const sel = document.getElementById("routine");
    routines.forEach((r,i)=> {
      const o=document.createElement("option");
      o.value=i;
      o.textContent=r.name;
      sel.appendChild(o);
    });

    let interval=null, stepIdx=0, remaining=0, paused=true, current=null;

    const $timer=document.getElementById("timer");
    const $pose=document.getElementById("poseName");
    const $info=document.getElementById("poseInfo");
    const $stepPill=document.getElementById("stepPill");
    const $routinePill=document.getElementById("routinePill");

    function fmt(s){
      const m = Math.floor(s/60).toString().padStart(2,'0');
      const sec = (s%60).toString().padStart(2,'0');
      return `${m}:${sec}`;
    }
    function getPoseById(id){ return POSES.find(p=>p.id===id); }

    function loadStep(){
      const step = current.steps[stepIdx];
      const pose = getPoseById(step.poseId) || {nome:"Posizione", benefici:""};
      remaining = step.sec;
      $pose.textContent = pose.nome;
      $info.textContent = pose.benefici || "‚Äî";
      $timer.textContent = fmt(remaining);
      $stepPill.textContent = `Step ${stepIdx+1}/${current.steps.length}`;
      $routinePill.textContent = current.name || "‚Äî";
    }

    function tick(){
      if(paused) return;
      remaining--;
      $timer.textContent = fmt(Math.max(0,remaining));
      if(remaining <= 0){
        stepIdx++;
        if(stepIdx >= current.steps.length){
          paused=true;
          clearInterval(interval);
          interval=null;
          $pose.textContent="Routine completata ‚úÖ";
          $info.textContent="Ottimo. Vuoi rifarla o sceglierne un‚Äôaltra?";
          $timer.textContent="00:00";
          $stepPill.textContent = `Step ${current.steps.length}/${current.steps.length}`;

          const done = JSON.parse(localStorage.getItem("yoga_done")||"[]");
          done.push({ts:Date.now(), routine:current.name});
          localStorage.setItem("yoga_done", JSON.stringify(done));
          return;
        }
        loadStep();
      }
    }

    document.getElementById("start").onclick = () => {
      if(!current){
        current = routines[+sel.value];
        stepIdx=0;
        loadStep();
      }
      paused=false;
      if(!interval) interval=setInterval(tick,1000);
    };

    document.getElementById("pause").onclick = () => paused=true;

    document.getElementById("reset").onclick = () => {
      paused=true; stepIdx=0; current=null;
      if(interval){ clearInterval(interval); interval=null; }
      $pose.textContent="Pronto";
      $info.textContent="Scegli una routine e premi Start.";
      $timer.textContent="00:00";
      $stepPill.textContent="Step 0/0";
      $routinePill.textContent="‚Äî";
    };

    sel.onchange = () => {
      stepIdx=0;
      current=null;
      $pose.textContent="Pronto";
      $info.textContent="Premi Start.";
      $timer.textContent="00:00";
      $stepPill.textContent="Step 0/0";
      $routinePill.textContent="‚Äî";
    };

    // ====== POSIZIONI: LISTA + DETTAGLIO + TIMER SINGOLO ======
    const $list = document.getElementById("poseList");
    const $search = document.getElementById("search");
    const $filterLevel = document.getElementById("filterLevel");
    const $detail = document.getElementById("poseDetail");
    let selectedPoseId = null;

    function renderList(){
      $detail.classList.add("hide");
      $list.classList.remove("hide");

      const q = ($search.value||"").trim().toLowerCase();
      const lvl = $filterLevel.value;

      const filtered = POSES.filter(p => {
        const text = (p.nome+" "+p.benefici+" "+(p.tags||[]).join(" ")).toLowerCase();
        const okQ = !q || text.includes(q);
        const okL = !lvl || p.livello === lvl;
        return okQ && okL;
      });

      $list.innerHTML = "";
      filtered.forEach(p => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="itemTitle">${p.nome}</div>
          <div class="mutedDark">${p.benefici}</div>
          <div style="margin-top:10px" class="row">
            <span class="pill">${p.livello}</span>
            <span class="pill">~ ${Math.max(1, Math.round((p.durataConsigliataSec||60)/60))} min</span>
          </div>
        `;
        div.onclick = () => showDetail(p.id);
        $list.appendChild(div);
      });

      if(filtered.length === 0){
        const empty = document.createElement("div");
        empty.className="card";
        empty.innerHTML = `<div class="mutedDark">Nessun risultato. Prova con un‚Äôaltra parola.</div>`;
        $list.appendChild(empty);
      }
    }

    function showDetail(id){
      selectedPoseId = id;
      const p = getPoseById(id);
      if(!p) return;

      document.getElementById("dName").textContent = p.nome;
      document.getElementById("dLevel").textContent = p.livello;
      document.getElementById("dTime").textContent = `Durata consigliata: ${fmt(p.durataConsigliataSec||60)}`;
      document.getElementById("dBenefits").textContent = p.benefici;

      const steps = document.getElementById("dSteps");
      const errs = document.getElementById("dErrors");
      steps.innerHTML = ""; errs.innerHTML = "";

      (p.istruzioni||[]).forEach(s => {
        const li=document.createElement("li");
        li.textContent=s;
        steps.appendChild(li);
      });

      (p.erroriComuni||[]).forEach(s => {
        const li=document.createElement("li");
        li.textContent=s;
        errs.appendChild(li);
      });

      $list.classList.add("hide");
      $detail.classList.remove("hide");
      window.scrollTo({top:0, behavior:"smooth"});
    }

    document.getElementById("back").onclick = () => {
      $detail.classList.add("hide");
      $list.classList.remove("hide");
    };

    document.getElementById("startPoseTimer").onclick = () => {
      if(!selectedPoseId) return;
      const p = getPoseById(selectedPoseId);
      if(!p) return;

      const secs = p.durataConsigliataSec ? p.durataConsigliataSec : 60;

      // crea una "routine" con 1 sola posa
      current = { name: p.nome, steps: [{ poseId: p.id, sec: secs }] };
      stepIdx = 0;
      paused = false;

      loadStep();

      // passa al timer e parte
      timerView.classList.remove("hide");
      posesView.classList.add("hide");

      if(!interval) interval = setInterval(tick, 1000);
    };

    $search.oninput = renderList;
    $filterLevel.onchange = renderList;

    // ====== PWA ======
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("/sw.js").catch(()=>{});
    }
  </script>
</body>
</html>

